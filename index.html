<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
      <style media="screen">
        /* Style inputs */
          input[type=text], input[type=email], textarea {
          width: 100%;
          padding: 12px 20px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
        }

        /* Style the submit button */
        button {
          width: 100%;
          background-color: #4CAF50;
          color: white;
          padding: 14px 20px;
          margin: 8px 0;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }

        /* Add a background color to the submit button on mouse-over */
        input[type=submit]:hover {
          background-color: #45a049;
        }
        table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
      </style>
    <title>Schedule Visitor to Aqua-Aerobic Systems, Inc</title>
  </head>
  <body>
       <div id="container">
    <h1>Schedule Visitor to Aqua-Aerobic Systems, Inc</h1> 
    <form>
       <label for="login">Aqua Employee Network Login ID</label>
      <input type="text" id="login" name="login" placeholder="Example: Chuck Konkol Network Login is: ckonkol">
      
      <label for="fname">First Name ***</label>
      <input type="text" id="fname" name="fname" placeholder="Enter their first name..">
      
       <label for="lname">Last Name ***</label>
      <input type="text" id="lname" name="lname" placeholder="Enter their last name..">
      
           <label for="cname">Company</label>
      <input type="text" id="cname" name="cname" placeholder="Enter their company name..">

      <label for="email">Email</label>
      <input type="email" id="email" name="email" placeholder="Enter their email address..">
      <br>
        <label for="date">Date & time of Visit ***</label>
        <input type="datetime-local" id="date" name="date">
<br><br>
      <label for="message">Purpose of Visit?</label>
      <textarea id="message" name="message" placeholder="Enter purpose of visit.." style="height:200px"></textarea>

      <button id="submit_msg" type="button">Schedule Meeting</button><br>
       <button id="get_msg" type="button">Get Meeting (*** marked fields required)</button>
         <button id="update_db" type="button">Update Meeting</button>
          <button id="get_id" type="button">Get By ID</button>
      
    </form>
            </div>
    <div id="table"></div>
  </body>
  <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-firestore.js"></script>
  <script type="text/javascript">
    (function() {
      var firebaseConfig = {
         apiKey: "AIzaSyC_Wl1RgIWazRk3OhodD5QQTykOcIyZMNs",
    authDomain: "aquacheckin-e0b0b.firebaseapp.com",
    projectId: "aquacheckin-e0b0b",
    storageBucket: "aquacheckin-e0b0b.appspot.com",
    messagingSenderId: "606092531450",
    appId: "1:606092531450:web:0cb5aa1499296eae14db43",
    measurementId: "G-T2LP2MT4DG"
      };

      firebase.initializeApp(firebaseConfig);

      var push_to_firebase = function(data){
        alert("Schedule was created successfully!")
        var db = firebase.firestore();
        var key = data["fname"] + data["lname"] + data["date"];
        var SaveDoc = db.collection("messages").doc(key);
        SaveDoc.set({
              login: data["login"],
            firstname: data["fname"],
          lastname: data["lname"],
          company: data["cname"],
          date: data["date"],
            email: data["email"],
            message: data["msg"],
            timestamp: Date.now()
        })
        .then(function(doc) {
            console.log("doc added");
            location.reload();
  }).catch(function(error) {
    console.log("Error getting document:", error);
  });
      }
      
      var update = function(data){
        alert("Schedule was created successfully!")
        var db = firebase.firestore();
          var key = data["fname"] + data["lname"] + data["date"];
        db.collection("messages").doc(key).update({
           login: data["login"],
   firstname: data["fname"],
          lastname: data["lname"],
          company: data["cname"],
          date: data["date"],
            email: data["email"],
            message: data["msg"],
            timestamp: Date.now()
}) .then(function(doc) {
    console.log("doc updated");
            location.reload();
  }).catch(function(error) {
    console.log("Error getting document:", error);
  });
      }
      var get_firebase = function(){
        alert("getting data!")
        var db = firebase.firestore();
         var get_fname = document.getElementById("fname").value ;
        var get_lname = document.getElementById("lname").value ;
          var get_date = document.getElementById("date").value ;
       get_fname  = get_fname.toString();
         get_lname  = get_lname.toString();
         get_date  = get_date.toString();
     console.log(get_fname);
         console.log(get_lname);
         console.log(get_date);
    db.collection("messages").where("lastname", "==",get_lname).where("firstname", "==",get_fname).where("date", "==", get_date )
    .get()
    .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
            // doc.data() is never undefined for query doc snapshots
            console.log(doc.id, " => ", doc.data());
           document.getElementById("login").value = doc.data().login;
           document.getElementById("login").readOnly = true;
            document.getElementById("fname").value = doc.data().firstname;
            document.getElementById("lname").value = doc.data().lastname;
            document.getElementById("cname").value = doc.data().company;
            document.getElementById("date").value = doc.data().date;
            document.getElementById("email").value = doc.data().email;
            document.getElementById("message").value = doc.data().message;
        });
    })
    .catch((error) => {
        console.log("Error getting documents: ", error);
    });
      }
      
       var loadfromid = function(data){
        alert("getting data!")
        var db = firebase.firestore();
    db.collection("messages").where("lastname", "==",data["lname"]).where("firstname", "==",data["fname"]).where("date", "==", data["date"])
    .get()
    .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
            // doc.data() is never undefined for query doc snapshots
            console.log(doc.id, " => ", doc.data());
           document.getElementById("login").value = doc.data().login;
           document.getElementById("login").readOnly = true;
            document.getElementById("fname").value = doc.data().firstname;
            document.getElementById("lname").value = doc.data().lastname;
            document.getElementById("cname").value = doc.data().company;
            document.getElementById("date").value = doc.data().date;
            document.getElementById("email").value = doc.data().email;
            document.getElementById("message").value = doc.data().message;
        });
    })
    .catch((error) => {
        console.log("Error getting documents: ", error);
    });
      }
      
       var loaddb = function(){
        alert("getting data!")
        var db = firebase.firestore();
         var get_login = document.getElementById("login").value ;
       get_login  = get_login.toString();
     console.log(get_login);
      var header = "<style>table, td, th {  border: 1px solid #ddd;  text-align: left;}table {  border-collapse: collapse;  width: 100%;}th, td {  padding: 15px;} tr:nth-child(even) {  background-color: #dddddd;}</style></head>";
    document.write("<h2>Aqua Check-in Schedule</h2><table>  <tr>    <th>Aqua Employee</th>    <th>First Name</th>    <th>Last Name</th>    <th>Company</th>     <th>Date/Time</th>      <th>Email</th>       <th>Purpose of Visit</th>     <th>Edit</th>  </tr>");
    var lines = "";
         db.collection("messages").where("login", "==",get_login)
    .get()
    .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
            // doc.data() is never undefined for query doc snapshots
            console.log(doc.id, " => ", doc.data());
        //   document.write(doc.data().login + "," + doc.data().firstname + "," + doc.data().lastname + "," + doc.data().company + "," + doc.data().date + "," + doc.data().email + "," + doc.data().message + "," +  doc.id + "<br>");
           var data = {
          "login": doc.data().login,
          "fname": doc.data().firstname,
               "lname": doc.data().lastname,
               "cname": doc.data().company,
          "email": doc.data().email,
          "msg": doc.data().message,
          "date":doc.data().date
        }
          document.write('<tr><td>' + doc.data().login + '</td><td>' + doc.data().firstname + '</td><td>' + doc.data().lastname + '</td><td>' + doc.data().company + '</td><td>' + doc.data().date + '</td><td>' + doc.data().email + '</td><td>' + doc.data().message + '</td><td><a href="#" onclick="loadfromid(' + data + ');">Click here</a></td></tr>');
        });
                  document.write("</table>");
       document.head.innerHTML = header;
    })
    .catch((error) => {
        console.log("Error getting documents: ", error);
    });
         
      }


      var contact_submit = function(){
         var login = document.getElementById("login");
        var fname = document.getElementById("fname");
        var lname = document.getElementById("lname");
        var cname = document.getElementById("cname");
          var date = document.getElementById("date");
        var email = document.getElementById("email");
        var msg = document.getElementById("message");

        var data = {
          "login": login.value,
          "fname": fname.value,
               "lname": lname.value,
               "cname": cname.value,
          "email": email.value,
          "msg": msg.value,
          "date": date.value
        }
        push_to_firebase(data);

      }
      
       var update_submit = function(){
           var login = document.getElementById("login");
        var fname = document.getElementById("fname");
        var lname = document.getElementById("lname");
        var cname = document.getElementById("cname");
          var date = document.getElementById("date");
        var email = document.getElementById("email");
        var msg = document.getElementById("message");

        var data = {
            "login": login.value,
          "fname": fname.value,
               "lname": lname.value,
               "cname": cname.value,
          "email": email.value,
          "msg": msg.value,
          "date": date.value
        }
        update(data);

      }

      document.getElementById("submit_msg").addEventListener("click", contact_submit);
       document.getElementById("get_msg").addEventListener("click", get_firebase);
       document.getElementById("update_db").addEventListener("click",update_submit);
       document.getElementById("get_id").addEventListener("click",loaddb);
    })();
  </script>
</html>
